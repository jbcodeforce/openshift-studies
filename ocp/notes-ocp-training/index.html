<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../../deployment-ex/ rel=prev><link href=../../spark-on-os/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Notes from certification - Kubernetes Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#notes-on-training class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Kubernetes Studies" class="md-header__button md-logo" aria-label="Kubernetes Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kubernetes Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Notes from certification </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/openshift-studies title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Kubernetes Studies" class="md-nav__button md-logo" aria-label="Kubernetes Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Kubernetes Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/openshift-studies title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=false> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../k8s/k8s-0/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-1/ class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-2/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-3/ class=md-nav__link> Demo it </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../k8s/k8s-comp/ class=md-nav__link> Compendium </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=true> Openshift <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Openshift data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Openshift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../os-cn-dev/ class=md-nav__link> Cloud Native Development </a> </li> <li class=md-nav__item> <a href=../cp4i/ class=md-nav__link> Cloud Pak Integration </a> </li> <li class=md-nav__item> <a href=../faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../oc-cli/ class=md-nav__link> oc CLI </a> </li> <li class=md-nav__item> <a href=../../deployment-ex/ class=md-nav__link> Deployment examples </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Notes from certification <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Notes from certification </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#do180 class=md-nav__link> DO180 </a> </li> <li class=md-nav__item> <a href=#container-technology class=md-nav__link> Container technology </a> </li> <li class=md-nav__item> <a href=#openshift class=md-nav__link> OpenShift </a> </li> <li class=md-nav__item> <a href=#quayio class=md-nav__link> Quay.io </a> </li> <li class=md-nav__item> <a href=#building-app class=md-nav__link> Building app </a> <nav class=md-nav aria-label="Building app"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deploying-containerized-applications-on-openshift class=md-nav__link> Deploying Containerized Applications on OpenShift </a> </li> <li class=md-nav__item> <a href=#scaling class=md-nav__link> Scaling </a> </li> <li class=md-nav__item> <a href=#deploy-multi-container-app class=md-nav__link> Deploy multi-container app </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#s2i class=md-nav__link> S2I </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#containerized-applications class=md-nav__link> Containerized applications </a> </li> <li class=md-nav__item> <a href=#compendium class=md-nav__link> Compendium </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../spark-on-os/ class=md-nav__link> Operators (with Spark) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=false> Operations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Operations data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sre/ class=md-nav__link> SRE </a> </li> <li class=md-nav__item> <a href=../../ansible/ class=md-nav__link> Ansible </a> </li> <li class=md-nav__item> <a href=../../spark-on-os/ class=md-nav__link> Operators (with Spark) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../compendium/ class=md-nav__link> Compendium </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#do180 class=md-nav__link> DO180 </a> </li> <li class=md-nav__item> <a href=#container-technology class=md-nav__link> Container technology </a> </li> <li class=md-nav__item> <a href=#openshift class=md-nav__link> OpenShift </a> </li> <li class=md-nav__item> <a href=#quayio class=md-nav__link> Quay.io </a> </li> <li class=md-nav__item> <a href=#building-app class=md-nav__link> Building app </a> <nav class=md-nav aria-label="Building app"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#deploying-containerized-applications-on-openshift class=md-nav__link> Deploying Containerized Applications on OpenShift </a> </li> <li class=md-nav__item> <a href=#scaling class=md-nav__link> Scaling </a> </li> <li class=md-nav__item> <a href=#deploy-multi-container-app class=md-nav__link> Deploy multi-container app </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#troubleshooting class=md-nav__link> Troubleshooting </a> <nav class=md-nav aria-label=Troubleshooting> <ul class=md-nav__list> <li class=md-nav__item> <a href=#s2i class=md-nav__link> S2I </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#containerized-applications class=md-nav__link> Containerized applications </a> </li> <li class=md-nav__item> <a href=#compendium class=md-nav__link> Compendium </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=notes-on-training>Notes on training<a class=headerlink href=#notes-on-training title="Permanent link">&para;</a></h1> <h2 id=do180>DO180<a class=headerlink href=#do180 title="Permanent link">&para;</a></h2> <p>student, which has the password student, root redhat Student workstation: workstation.lab.example.com http://rol.redhat.com Students also have access to a MySQL and a Nexus server hosted by either the OpenShift cluster or by AWS github.com jbcodeforce quay.io jbcodeforce</p> <h2 id=container-technology>Container technology<a class=headerlink href=#container-technology title="Permanent link">&para;</a></h2> <p>Difference between container applications and traditional deployments</p> <ul> <li>The major drawback to traditionally deployed software application is that the application's dependencies are entangled with the runtime environment</li> <li> <p>A traditionally deployed application must be stopped before updating the associated dependencies</p> <div class=codehilite><pre><span></span><code>* App server + deployed apps becomes a complex system to provide high availability
</code></pre></div> </li> <li> <p>A container is a set of one or more processes that are isolated from the rest of the system. </p> <div class=codehilite><pre><span></span><code><span class=o>*</span><span class=w> </span><span class=nv>security</span>,<span class=w> </span><span class=nv>storage</span>,<span class=w> </span><span class=nv>and</span><span class=w> </span><span class=nv>network</span><span class=w> </span><span class=nv>isolation</span>
<span class=o>*</span><span class=w> </span><span class=nv>isolate</span><span class=w> </span><span class=nv>dependent</span><span class=w> </span><span class=nv>libraries</span><span class=w> </span><span class=nv>and</span><span class=w> </span><span class=nv>run</span><span class=w> </span><span class=nv>time</span><span class=w> </span><span class=nv>resources</span>
<span class=o>*</span><span class=w> </span><span class=nv>less</span><span class=w> </span><span class=nv>resources</span><span class=w> </span><span class=nv>than</span><span class=w> </span><span class=nv>VM</span>,<span class=w> </span><span class=nv>start</span><span class=w> </span><span class=nv>quickly</span>.
<span class=o>*</span><span class=w> </span><span class=nv>helps</span><span class=w> </span><span class=nv>with</span><span class=w> </span><span class=nv>the</span><span class=w> </span><span class=nv>efficiency</span>,<span class=w> </span><span class=nv>elasticity</span>,<span class=w> </span><span class=nv>and</span><span class=w> </span><span class=nv>reusability</span><span class=w> </span><span class=nv>of</span><span class=w> </span><span class=nv>the</span><span class=w> </span><span class=nv>hosted</span><span class=w> </span><span class=nv>applications</span>,<span class=w> </span><span class=nv>and</span><span class=w> </span><span class=nv>portability</span>
<span class=o>*</span><span class=w> </span>[<span class=nv>Open</span><span class=w> </span><span class=nv>Container</span><span class=w> </span><span class=nv>initiative</span>]<span class=ss>(</span><span class=nv>https</span>:<span class=o>//</span><span class=nv>www</span>.<span class=nv>opencontainers</span>.<span class=nv>org</span><span class=o>/</span><span class=ss>)</span><span class=w> </span><span class=nv>to</span><span class=w> </span><span class=nv>govern</span><span class=w> </span><span class=nv>specifications</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=nv>container</span><span class=w> </span><span class=nv>runtime</span><span class=w> </span><span class=nv>and</span><span class=w> </span><span class=nv>image</span><span class=w> </span><span class=nv>definition</span>.
<span class=nv>The</span><span class=w> </span><span class=nv>Runtime</span><span class=w> </span><span class=nv>Specification</span><span class=w> </span><span class=nv>outlines</span><span class=w> </span><span class=nv>how</span><span class=w> </span><span class=nv>to</span><span class=w> </span><span class=nv>run</span><span class=w> </span><span class=nv>a</span><span class=w> </span>“<span class=nv>filesystem</span><span class=w> </span><span class=nv>bundle</span>”<span class=w> </span><span class=nv>that</span><span class=w> </span><span class=nv>is</span><span class=w> </span><span class=nv>unpacked</span><span class=w> </span><span class=nv>on</span><span class=w> </span><span class=nv>disk</span>
</code></pre></div> <ul> <li>Container image: bundle of files and metadata</li> <li>Container engine: Rocket, Drawbridge, LXC, Docker, and Podman</li> </ul> </li> <li> <p>Started in 2001 with VServer, then move to isolated process which leverages the following linux features:</p> <div class=codehilite><pre><span></span><code>* **Namespaces**: The kernel can isolate specific system resources, usually visible to all processes, by placing the resources within a namespace.
</code></pre></div> <p>Namespaces can include resources like network interfaces, the process ID list, mount points, IPC resources, and the system's host name information. * <strong>cgroups</strong>: Control groups partition sets of processes and their children into groups to manage and limit the resources they consume. * <strong>Seccomp</strong> defines a security profile for processes, whitelisting the system calls, parameters and file descriptors they are allowed to use * <strong>SELinux</strong> (Security-Enhanced Linux) is a mandatory access control system for processes. Protect processes from each other and to protect the host system from its running processes</p> </li> </ul> <h2 id=openshift>OpenShift<a class=headerlink href=#openshift title="Permanent link">&para;</a></h2> <p>RHOCP adds the capabilities to provide a production PaaS platform such as remote management, multi tenancy, increased security, monitoring and auditing, application life-cycle management, and self-service interfaces for developers.</p> <div class=highlight><pre><span></span><code>Username    RHT_OCP4_DEV_USER   boyerje-us
Password    RHT_OCP4_DEV_PASSWORD   &lt;&gt;
API Endpoint    RHT_OCP4_MASTER_API https://api.ocp-na2.prod.nextcle.com:6443
Console Web Application     https://console-openshift-console.apps.ocp-na2.prod.nextcle.com
Cluster ID ...
</code></pre></div> <p>Container images are named based on the following syntax: <code>registry_name/user_name/image_name:tag</code></p> <p>Example of images used:</p> <div class=highlight><pre><span></span><code><span class=c1># login to a registry</span>
sudo<span class=w> </span>podman<span class=w> </span>login<span class=w> </span>-u<span class=w> </span>username<span class=w> </span>-p<span class=w> </span>password<span class=w> </span>registry.access.redhat.com
sudo<span class=w> </span>podman<span class=w> </span>run<span class=w> </span>ubi7/ubi:7.7<span class=w> </span><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;Hello!&quot;</span>
<span class=c1># Apache http server</span>
sudo<span class=w> </span>podman<span class=w> </span>run<span class=w> </span>-d<span class=w> </span>rhscl/httpd-24-rhel7:2.4-36.8
<span class=c1># Get IP address of a last container started</span>
podman<span class=w> </span>inspect<span class=w> </span>-l<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;{{.NetworkSettings.IPAddress}}&quot;</span><span class=w> </span>
<span class=c1># mysql</span>
sudo<span class=w> </span>podman<span class=w> </span>run<span class=w> </span>--name<span class=w> </span>mysql-basic<span class=w> </span>-v<span class=w> </span>/var/local/mysql:/var/lib/mysql/data<span class=w> </span><span class=se>\</span>
&gt;<span class=w> </span>-e<span class=w> </span><span class=nv>MYSQL_USER</span><span class=o>=</span>user1<span class=w> </span>-e<span class=w> </span><span class=nv>MYSQL_PASSWORD</span><span class=o>=</span>mypa55<span class=w> </span><span class=se>\</span>
&gt;<span class=w> </span>-e<span class=w> </span><span class=nv>MYSQL_DATABASE</span><span class=o>=</span>items<span class=w> </span>-e<span class=w> </span><span class=nv>MYSQL_ROOT_PASSWORD</span><span class=o>=</span>r00tpa55<span class=w> </span><span class=se>\</span>
&gt;<span class=w> </span>-d<span class=w> </span>rhscl/mysql-57-rhel7:5.7-3.14
<span class=c1># Stop and start a container</span>
sudo<span class=w> </span>podman<span class=w> </span>stop<span class=w> </span>my-httpd-container
sudo<span class=w> </span>podman<span class=w> </span>restart<span class=w> </span>my-httpd-container
<span class=c1># Send a SIGKILL</span>
sudo<span class=w> </span>podman<span class=w> </span><span class=nb>kill</span><span class=w> </span>my-httpd-container
</code></pre></div> <h2 id=quayio>Quay.io<a class=headerlink href=#quayio title="Permanent link">&para;</a></h2> <p><strong>Quay.io</strong> introduces several features, such as server-side image building, fine-grained access controls, and automatic scanning of images for known vulnerabilities.</p> <p>Created an account with jbcodeforce user.</p> <div class=highlight><pre><span></span><code><span class=c1># login</span>
docker<span class=w> </span>login<span class=w> </span>quay.io
<span class=c1># Commit an container as image to quay </span>
docker<span class=w> </span>commit<span class=w> </span>b18bc52f5f3c<span class=w> </span>quay.io/jbcodeforce/vaccineorderms:0.1.0
<span class=c1># push</span>
docker<span class=w> </span>push<span class=w> </span>quay.io/jbcodeforce/vaccineorderms:0.1.0
</code></pre></div> <p>To configure registries for the <code>podman</code> command, you need to update the <code>/etc/containers/registries.conf</code>. The podman search command finds images from all the registries listed in this file.</p> <div class=highlight><pre><span></span><code><span class=o>[</span>registries.search<span class=o>]</span>
<span class=nv>registries</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=s2>&quot;registry.access.redhat.com&quot;</span>,<span class=w> </span><span class=s2>&quot;quay.io&quot;</span><span class=o>]</span>
</code></pre></div> <p>Use an FQDN and port number (5000 default) to identify a registry. </p> <p>By default, Podman stores container images in the /var/lib/containers/storage/overlay-images directory.</p> <p>Existing images from the Podman local storage can be saved to a .tar file using the <code>podman save</code> command.</p> <div class=highlight><pre><span></span><code><span class=c1># Retrieve the list of external files and directories that Podman mounts to the running container</span>
sudo<span class=w> </span>podman<span class=w> </span>inspect<span class=w> </span>-f<span class=w> </span><span class=s2>&quot;{{range .Mounts}}{{println .Destination}}{{end}}&quot;</span><span class=w> </span>official-httpd
<span class=c1># list of modified files in the container file system</span>
sudo<span class=w> </span>podman<span class=w> </span>diff<span class=w> </span>official-httpd
<span class=c1># Commit the changes to a new container image with a new name</span>
sudo<span class=w> </span>podman<span class=w> </span>commit<span class=w> </span>-a<span class=w> </span><span class=s1>&#39;Jerome&#39;</span><span class=w> </span>official-httpd<span class=w> </span>do180-custom-httpd
sudo<span class=w> </span>podman<span class=w> </span>save<span class=w> </span><span class=o>[</span>-o<span class=w> </span>FILE_NAME<span class=o>]</span><span class=w> </span>IMAGE_NAME<span class=o>[</span>:TAG<span class=o>]</span>
sudo<span class=w> </span>podman<span class=w> </span>tag<span class=w> </span>quay.io/jbcodeforce/do180-custom-httpd:v1.0
sudo<span class=w> </span>podman<span class=w> </span>push<span class=w> </span>quay.io/jbcodeforce/do180-custom-httpd:v1.0
sudo<span class=w> </span>podman<span class=w> </span>build<span class=w> </span>-t<span class=w> </span>NAME:TAG<span class=w> </span>DIR
<span class=c1># examine the content of the environment variable of a container</span>
sudo<span class=w> </span>podman<span class=w> </span><span class=nb>exec</span><span class=w> </span>todoapi<span class=w> </span>env
</code></pre></div> <p>Red Hat Software Collections Library is the source of most container images</p> <h2 id=building-app>Building app<a class=headerlink href=#building-app title="Permanent link">&para;</a></h2> <p>In OpenShift, a build is the process of creating a runnable container image from application source code. A <em>BuildConfig</em> resource defines the entire build process. OpenShift can create container images from source code without the need for tools such as Docker or Podman. Images are stored in the internal <em>container registry</em>.</p> <p>In an <em>Source to Image</em> S2I build, application source code is combined with an S2I builder image, which is a container image containing the tools, libraries, and frameworks required to run the application.</p> <p>After an application is deployed on OpenShift, then OpenShift can rebuild and redeploy a new container image anytime the application source code is modified.</p> <p>OpenShift generates unique webhook URLs for applications that are built from source stored in Git repositories. Webhooks are configured on a Git repository. Based on the webhook configuration, GitHub will send a HTTP POST request to the webhook URL, with details that include the latest commit information. The OpenShift REST API listens for webhook notifications at this URL, and then triggers a new build automatically. You must configure your webhook to point to this unique URL.</p> <p>In the git repos use <code>Settings &gt; Webhooks</code> and then from the OpenShift build resource detail view scroll down to the webhooks URL</p> <h3 id=deploying-containerized-applications-on-openshift>Deploying Containerized Applications on OpenShift<a class=headerlink href=#deploying-containerized-applications-on-openshift title="Permanent link">&para;</a></h3> <p>Lab:</p> <div class=highlight><pre><span></span><code><span class=c1># login to cluster </span>
oc<span class=w> </span>login<span class=w> </span>-u<span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_DEV_USER</span><span class=si>}</span><span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_DEV_PASSWORD</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_MASTER_API</span><span class=si>}</span>
<span class=c1># Create a new project named &quot;youruser-ocp&quot;</span>
oc<span class=w> </span>new-project<span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_DEV_USER</span><span class=si>}</span>-ocp
<span class=c1># Create a temperature converter application written in PHP using the php:7.1 image stream tag. </span>
<span class=c1># The source code is in the Git repository at https://github.com/RedHatTraining/DO180-apps/</span>
oc<span class=w> </span>new-app<span class=w> </span>php:7.1~https://github.com/RedHatTraining/DO180-apps<span class=w> </span>--context-dir<span class=w> </span>temps<span class=w> </span>--name<span class=w> </span>temps
<span class=c1># Monitor progress of the build</span>
oc<span class=w> </span>logs<span class=w> </span>-f<span class=w> </span>bc/temps
<span class=c1># Verify that the application is deployed.</span>
oc<span class=w> </span>get<span class=w> </span>pods<span class=w> </span>-w
<span class=c1># Expose the temps service to create an external route for the application.</span>
oc<span class=w> </span>expose<span class=w>  </span>svc/temps
<span class=c1># Determine route URL</span>
<span class=w> </span>oc<span class=w> </span>get<span class=w> </span>route/temps
</code></pre></div> <p>Other example for a nodejs app, the source code from git of a specific branch (devenv-versioning) and other context.</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>new-app<span class=w> </span>--name<span class=w> </span>demonode<span class=w> </span>https://github.com/jbcodeforce/DO180-apps#devenv-versioning<span class=w> </span>--context-dir<span class=w> </span>express-helloworld
oc<span class=w> </span>expose<span class=w> </span>svc<span class=w> </span>demonode
</code></pre></div> <h3 id=scaling>Scaling<a class=headerlink href=#scaling title="Permanent link">&para;</a></h3> <p>When scaling up an application, the OpenShift platform first deploys a new pod and then waits for the pod to be ready. Only after the new pod becomes available does the OpenShift platform configure the route to also send traffic to the new pod. </p> <p>When scaling down, OpenShift reconfigures the route to stop sending traffic to the pod, and then deletes the pod.</p> <p>If the application is maintaining session state, then it is important to keep those session data into a central store like a DB, redis or memcached.</p> <p>Databases, such as MariaDB and PostgreSQL, do not usually support running in multiple pods. </p> <p>Routes need to be configured to support sending message to different pods, via round-robin algorithm. Here is an example of yaml configuration to support this behavior:</p> <div class=highlight><pre><span></span><code><span class=w> </span><span class=nt>annotations</span><span class=p>:</span>
<span class=w>    </span><span class=nt>haproxy.router.openshift.io/balance</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">roundrobin</span>
<span class=w>    </span><span class=nt>haproxy.router.openshift.io/disable_cookies</span><span class=p>:</span><span class=w> </span><span class=s>&#39;true&#39;</span>
<span class=w>    </span><span class=nt>openshift.io/host.generated</span><span class=p>:</span><span class=w> </span><span class=s>&#39;true&#39;</span>
</code></pre></div> <p>In addition to manual scaling, OpenShift provides the Horizontal Pod Autoscaler (HPA) feature. HPA automatically increases or decreases the number of pods depending on average CPU utilization. Developers can also configure HPA to use custom application metrics for scaling.</p> <p>To set up autoscale, we need to use oc CLI</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>get<span class=w> </span>dc
oc<span class=w> </span>autoscale<span class=w> </span>dc/php-scale2<span class=w> </span>--max<span class=o>=</span><span class=m>3</span><span class=w> </span>--cpu-percent<span class=o>=</span><span class=m>20</span>
</code></pre></div> <h3 id=deploy-multi-container-app>Deploy multi-container app<a class=headerlink href=#deploy-multi-container-app title="Permanent link">&para;</a></h3> <p>Podman uses Container Network Interface (CNI) to create a software-defined network (SDN) between all containers in the host. Unless stated otherwise, CNI assigns a new IP address to a container when it starts.</p> <p>Each container exposes all ports to other containers in the same SDN. As such, services are readily accessible within the same network. The containers expose ports to external networks only by explicit configuration.</p> <p>Using environment variables allows you to share information between containers with Podman. However, there are still some limitations and some manual work involved in ensuring that all environment variables stay in sync, especially when working with many containers</p> <p>Any service defined on Kubernetes generates environment variables for the IP address and port number where the service is available. Kubernetes automatically injects these environment variables into the containers from pods in the same namespace</p> <p>Get the list of templates from where to create k8s resources like Secret, a Service, a PersistentVolumeClaim, and a DeploymentConfig: <code>oc get template -n openshift</code> and then from one of the template: <code>oc get template mysql-persistent -n openshift -o yaml</code>.</p> <p>With template, you can publish a new template to the OpenShift cluster so that other developers can build an application from the template.</p> <p>Get the parameters of a template: <code>process --parameters mysql-persistent -n openshift</code>.</p> <p>From the template create the app resources file and then deploy the app:</p> <div class=highlight><pre><span></span><code><span class=c1># first export the template</span>
oc<span class=w> </span>get<span class=w> </span>template<span class=w> </span>mysql-persistent<span class=w> </span>-o<span class=w> </span>yaml<span class=w> </span>-n<span class=w> </span>openshift<span class=w> </span>&gt;<span class=w> </span>mysql-persistent-template.yaml
<span class=c1># identify appropriate values for the template parameters and process the template</span>
oc<span class=w> </span>process<span class=w> </span>-f<span class=w> </span>mysql-persistent-template.yaml<span class=w> </span>-p<span class=w> </span><span class=nv>MYSQL_USER</span><span class=o>=</span>dev<span class=w> </span>-p<span class=w> </span><span class=nv>MYSQL_PASSWORD</span><span class=o>=</span><span class=nv>$P4SSD</span><span class=w> </span>-p<span class=w> </span><span class=nv>MYSQL_DATABASE</span><span class=o>=</span>bank<span class=w> </span>-p<span class=w> </span><span class=nv>VOLUME_CAPACITY</span><span class=o>=</span>10Gi<span class=w> </span><span class=p>|</span><span class=w> </span>oc<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>-
<span class=c1># or using new-app</span>
oc<span class=w> </span>new-app<span class=w> </span>--template<span class=o>=</span>mysql-persistent<span class=w> </span>-p<span class=w> </span><span class=nv>MYSQL_USER</span><span class=o>=</span>dev<span class=w> </span>-p<span class=w> </span><span class=nv>MYSQL_PASSWORD</span><span class=o>=</span><span class=nv>$P4SSD</span><span class=w> </span>-p<span class=w> </span><span class=nv>MYSQL_DATABASE</span><span class=o>=</span>bank<span class=w> </span>-p<span class=w> </span><span class=nv>VOLUME_CAPACITY</span><span class=o>=</span>10Gi
</code></pre></div> <p>Lab:</p> <div class=highlight><pre><span></span><code><span class=c1># login to cluster </span>
oc<span class=w> </span>login<span class=w> </span>-u<span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_DEV_USER</span><span class=si>}</span><span class=w> </span>-p<span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_DEV_PASSWORD</span><span class=si>}</span><span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_MASTER_API</span><span class=si>}</span>
<span class=c1># Create a new project named &quot;youruser-&quot;</span>
oc<span class=w> </span>new-project<span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_DEV_USER</span><span class=si>}</span>-deploy
<span class=c1># Build the MySQL Database image</span>
sudo<span class=w> </span>podman<span class=w> </span>build<span class=w> </span>-t<span class=w> </span>do180-mysql-57-rhel7<span class=w> </span>.
<span class=c1># Push the MySQL image to the your Quay.io repository.</span>
sudo<span class=w> </span>podman<span class=w> </span>login<span class=w> </span>quay.io<span class=w> </span>-u<span class=w> </span><span class=si>${</span><span class=nv>RHT_OCP4_QUAY_USER</span><span class=si>}</span>
sudo<span class=w> </span>podman<span class=w> </span>tag<span class=w> </span>do180-mysql-57-rhel7<span class=w> </span>quay.io/<span class=si>${</span><span class=nv>RHT_OCP4_QUAY_USER</span><span class=si>}</span>/do180-mysql-57-rhel7
sudo<span class=w> </span>podman<span class=w> </span>push<span class=w> </span>quay.io/<span class=si>${</span><span class=nv>RHT_OCP4_QUAY_USER</span><span class=si>}</span>/do180-mysql-57-rhel7
</code></pre></div> <h2 id=troubleshooting>Troubleshooting<a class=headerlink href=#troubleshooting title="Permanent link">&para;</a></h2> <h3 id=s2i>S2I<a class=headerlink href=#s2i title="Permanent link">&para;</a></h3> <p>The S2I image creation process is composed of the build (The BuildConfig (BC) OpenShift resources drive it) and deploy (The DeploymentConfig resources) steps.</p> <ul> <li>retrieve the logs from a build configuration: <code>oc logs bc/&lt;application-name&gt;</code></li> <li>request a new build <code>oc start-build &lt;application-name&gt;</code></li> <li>Deployment logs: <code>oc logs dc/&lt;appname&gt;</code></li> </ul> <p>If a container could not access a file system, it may come to the container running under a specific user so we need to authorize by : <code>oc adm policy add-scc-to-user anyuid -z default</code>.</p> <ul> <li>Make sure the ownership and permissions of the directory are set according to the USER directive in the Dockerfile that was used to build the container being deployed</li> </ul> <p>To avoid file system permission issues, local folders used for container volume mounts must satisfy the following: * The user executing the container processes must be the owner of the folder * The local folder must satisfy the SELinux requirements to be used as a container volume. Assign the container_file_t group to the folder by using the semanage fcontext -a -t container_file_t <folder> command, then refresh the permissions with the restorecon -R <folder> command. * Run the <code>oc adm prune</code> command for an automated way to remove obsolete images and other resources.</p> <h2 id=containerized-applications>Containerized applications<a class=headerlink href=#containerized-applications title="Permanent link">&para;</a></h2> <p>To connect to a admin console of a pod, we can use: <code>oc port-forward</code> for forwarding a local port to a pod port. If the image enable remote debugging by exposing a port number, then port-forwarding, will let the IDE access the JVM to debug step by step via the Java Debug Wire Protocol (JDWP).</p> <p>Use openshift events to see the problem at a higher level: <code>oc get events</code>.</p> <p>To add tools like ping, telnet, iputils, dig ... into a pod, just mount local file to volume and directory like /bin, /sbin, /lib...</p> <p>To copy file to or from a container, <code>podman cp</code> is useful, or use exec: </p> <div class=highlight><pre><span></span><code>sudo<span class=w> </span>podman<span class=w> </span><span class=nb>exec</span><span class=w> </span>-i<span class=w> </span>&lt;container&gt;<span class=w> </span>mysql<span class=w> </span>-uroot<span class=w> </span>-proot<span class=w> </span>&lt;<span class=w> </span>/path/on/host/db.sql<span class=w> </span>&lt;<span class=w> </span>db.sql
<span class=c1># or</span>
sudo<span class=w> </span>podman<span class=w> </span><span class=nb>exec</span><span class=w> </span>-it<span class=w> </span>&lt;containerName&gt;<span class=w> </span>sh<span class=w> </span>-c<span class=w> </span><span class=s1>&#39;exec mysqldump -h&quot;$MYSQL_PORT_3306_TCP_ADDR&quot; \</span>
<span class=s1> -P&quot;$MYSQL_PORT_3306_TCP_PORT&quot;  -uroot -p&quot;$MYSQL_ENV_MYSQL_ROOT_PASSWORD&quot; items&#39;</span><span class=w>  </span>&gt;<span class=w> </span>db_dump.sql
</code></pre></div> <h2 id=compendium>Compendium<a class=headerlink href=#compendium title="Permanent link">&para;</a></h2> <ul> <li><a href=https://www.opencontainers.org/ >Open Container initiave</a></li> <li><a href=https://podman.io/ >Podman, the daemonless container engine for developing, managing, and running OCI Containers on your Linux System</a></li> <li><a href=https://quay.io>Quay image registry</a></li> <li><a href=https://kubernetes.io/ >kubernetes</a></li> <li><a href=https://www.openshift.com/ >openshift</a></li> <li><a href=https://rol.redhat.com/rol/app/apd.html>Git commands summary</a></li> </ul> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.expand", "navigation.tabs.sticky", "navigation.top"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>