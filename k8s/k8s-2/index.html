<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../k8s-1/ rel=prev><link href=../k8s-3/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Security - Kubernetes Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#security class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Kubernetes Studies" class="md-header__button md-logo" aria-label="Kubernetes Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kubernetes Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Security </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/openshift-studies title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Kubernetes Studies" class="md-nav__button md-logo" aria-label="Kubernetes Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Kubernetes Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/openshift-studies title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=true> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../k8s-0/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../k8s-1/ class=md-nav__link> Networking </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Security <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Security </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#role-based-access-control class=md-nav__link> Role Based Access Control </a> </li> <li class=md-nav__item> <a href=#security-context-constraints class=md-nav__link> Security Context Constraints </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../k8s-3/ class=md-nav__link> Demo it </a> </li> <li class=md-nav__item> <a href=../k8s-faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../k8s-comp/ class=md-nav__link> Compendium </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=false> Openshift <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Openshift data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Openshift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ocp/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../os-cn-dev/ class=md-nav__link> Cloud Native Development </a> </li> <li class=md-nav__item> <a href=../../ocp/cp4i/ class=md-nav__link> Cloud Pak Integration </a> </li> <li class=md-nav__item> <a href=../../ocp/faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../ocp/oc-cli/ class=md-nav__link> oc CLI </a> </li> <li class=md-nav__item> <a href=../../deployment-ex/ class=md-nav__link> Deployment examples </a> </li> <li class=md-nav__item> <a href=../../ocp/notes-ocp-training/ class=md-nav__link> Notes from certification </a> </li> <li class=md-nav__item> <a href=../../spark-on-os/ class=md-nav__link> Operators (with Spark) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=false> Operations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Operations data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sre/ class=md-nav__link> SRE </a> </li> <li class=md-nav__item> <a href=../../ansible/ class=md-nav__link> Ansible </a> </li> <li class=md-nav__item> <a href=../../spark-on-os/ class=md-nav__link> Operators (with Spark) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../compendium/ class=md-nav__link> Compendium </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#role-based-access-control class=md-nav__link> Role Based Access Control </a> </li> <li class=md-nav__item> <a href=#security-context-constraints class=md-nav__link> Security Context Constraints </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=security>Security<a class=headerlink href=#security title="Permanent link">&para;</a></h1> <p>With kubernetes deployed internally, companies have control over their physical environment, network, operating system patches, access to authentication and authorization internal registry. They control data access, access to administration console for the platform and the workload deployed.</p> <p>As part of security is the Identity and Access Management to control access to resource and connection protocol like <a href=https://openid.net/what-is-openid>OpenID</a>. A team is a logical grouping of resources, users, and user groups. Teams can be restricted to all resources within a namespace. Access control gateway enforces role-based access control (RBAC) for all registered services.</p> <p>Network segmentation to provide isolation, using DMZ VLAN for specific workload, so deploying cluster in DMZ. And use VLAN to segment the physical network, subnets, clusters and namespaces to add more segmentation. </p> <p><img alt src=../images/net-segment.png> </p> <p>Segmentation will depend of the application requirements.</p> <p>For securing kubernetes network control, you will have Edge nodes that are worker nodes with only ingress workloads and network policies. Traffic reaches application through private network. Backend services may not be accessible from public network. K8s <a href=https://kubernetes.io/docs/concepts/services-networking/network-policies/ >network policy</a> specifies how pods can communicate with each other, and <a href=https://www.projectcalico.org/ >Calico</a>, the IP based networking, implements the policies (rule per IP addresses). Rules are ORe'ed, if any ingress / egress rule matches connection is allowed. Their are scoped at namespace level.</p> <p>We can isolate application using labels. The <code>srv1</code> backend can be accessed only from the frontend</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=err> </span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend-allow</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=err> </span><span class=w> </span><span class=nt>podSelector</span><span class=p>:</span>
<span class=err>   </span><span class=w> </span><span class=nt>matchLabels</span><span class=p>:</span>
<span class=err>     </span><span class=w> </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Srv1</span>
<span class=err>     </span><span class=w> </span><span class=nt>Tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
<span class=err> </span><span class=w> </span><span class=nt>ingress</span><span class=p>:</span>
<span class=err> </span><span class=w> </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>from</span><span class=p>:</span>
<span class=err>     </span><span class=w> </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>podSelector</span><span class=p>:</span>
<span class=err>         </span><span class=w> </span><span class=nt>matchLabels</span><span class=p>:</span>
<span class=err>           </span><span class=w> </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Srv1</span>
<span class=err>           </span><span class=w> </span><span class=nt>Tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</code></pre></div> <p>and the db backend can only be accessed from the <code>srv1</code> backend.</p> <div class=highlight><pre><span></span><code><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">NetworkPolicy</span>
<span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=err> </span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db-allow</span>
<span class=nt>spec</span><span class=p>:</span>
<span class=err> </span><span class=w> </span><span class=nt>podSelector</span><span class=p>:</span>
<span class=err>   </span><span class=w> </span><span class=nt>matchLabels</span><span class=p>:</span>
<span class=err>     </span><span class=w> </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Srv1</span>
<span class=err>     </span><span class=w> </span><span class=nt>Tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">db</span>
<span class=err> </span><span class=w> </span><span class=nt>ingress</span><span class=p>:</span>
<span class=err> </span><span class=w> </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>from</span><span class=p>:</span>
<span class=err>     </span><span class=w> </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>podSelector</span><span class=p>:</span>
<span class=err>         </span><span class=w> </span><span class=nt>matchLabels</span><span class=p>:</span>
<span class=err>           </span><span class=w> </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Srv1</span>
<span class=err>           </span><span class=w> </span><span class=nt>Tier</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</code></pre></div> <h2 id=role-based-access-control>Role Based Access Control<a class=headerlink href=#role-based-access-control title="Permanent link">&para;</a></h2> <p>Add a user to a role:</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>adm<span class=w> </span>policy<span class=w> </span>add-cluster-role-to-user<span class=w> </span>strimzi-cluster-operator-namespaced<span class=w> </span>IAM#emailasuserid@something.com
</code></pre></div> <h2 id=security-context-constraints>Security Context Constraints<a class=headerlink href=#security-context-constraints title="Permanent link">&para;</a></h2> <ul> <li>Security Context Constraints (SCCs) to control permissions a pod can perform and what resources it can access</li> <li>Access to existing SCC: <code>kubectl get scc</code></li> <li>Get security policies for a scc: <code>oc describe scc privileged</code></li> <li>You can specify SCCs as resources that are handled by RBAC. This allows you to scope access to your SCCs to a certain project or to the entire cluster. Assigning users, groups, or service accounts directly to an SCC retains cluster-wide scope See <a href=https://docs.openshift.com/container-platform/4.7/authentication/managing-security-context-constraints.html>explanations here</a></li> </ul> <p><a href=../k8s-1/ >&lt;&lt; PREV</a> <a href=../k8s-3/ >&gt;&gt; NEXT</a></p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.expand", "navigation.tabs.sticky", "navigation.top"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>