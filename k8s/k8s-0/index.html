<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=prev href=../..><link href=../k8s-1/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Introduction - Kubernetes Studies</title><link rel=stylesheet href=../../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#kubernetes-introduction class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title="Kubernetes Studies" class="md-header__button md-logo" aria-label="Kubernetes Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kubernetes Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Introduction </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/openshift-studies title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title="Kubernetes Studies" class="md-nav__button md-logo" aria-label="Kubernetes Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Kubernetes Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/openshift-studies title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_2 type=checkbox id=__nav_2 checked> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=true> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Introduction <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Introduction </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#key-features class=md-nav__link> Key features </a> </li> <li class=md-nav__item> <a href=#components class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=#value-propositions class=md-nav__link> Value Propositions </a> <nav class=md-nav aria-label="Value Propositions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#value-propositions-for-container class=md-nav__link> Value propositions for container </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#concepts class=md-nav__link> Concepts </a> </li> <li class=md-nav__item> <a href=#kubernetes-objects class=md-nav__link> Kubernetes Objects </a> <nav class=md-nav aria-label="Kubernetes Objects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#volumes class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=#configmaps class=md-nav__link> ConfigMaps </a> </li> <li class=md-nav__item> <a href=#secret class=md-nav__link> Secret </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../k8s-1/ class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../k8s-2/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../k8s-3/ class=md-nav__link> Demo it </a> </li> <li class=md-nav__item> <a href=../k8s-faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../k8s-comp/ class=md-nav__link> Compendium </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=false> Openshift <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Openshift data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Openshift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../ocp/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../os-cn-dev/ class=md-nav__link> Cloud Native Development </a> </li> <li class=md-nav__item> <a href=../../ocp/cp4i/ class=md-nav__link> Cloud Pak Integration </a> </li> <li class=md-nav__item> <a href=../../ocp/faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../../ocp/oc-cli/ class=md-nav__link> oc CLI </a> </li> <li class=md-nav__item> <a href=../../deployment-ex/ class=md-nav__link> Deployment examples </a> </li> <li class=md-nav__item> <a href=../../ocp/notes-ocp-training/ class=md-nav__link> Notes from certification </a> </li> <li class=md-nav__item> <a href=../../spark-on-os/ class=md-nav__link> Operators (with Spark) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=false> Operations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Operations data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../sre/ class=md-nav__link> SRE </a> </li> <li class=md-nav__item> <a href=../../ansible/ class=md-nav__link> Ansible </a> </li> <li class=md-nav__item> <a href=../../spark-on-os/ class=md-nav__link> Operators (with Spark) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../compendium/ class=md-nav__link> Compendium </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#key-features class=md-nav__link> Key features </a> </li> <li class=md-nav__item> <a href=#components class=md-nav__link> Components </a> </li> <li class=md-nav__item> <a href=#value-propositions class=md-nav__link> Value Propositions </a> <nav class=md-nav aria-label="Value Propositions"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#value-propositions-for-container class=md-nav__link> Value propositions for container </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#concepts class=md-nav__link> Concepts </a> </li> <li class=md-nav__item> <a href=#kubernetes-objects class=md-nav__link> Kubernetes Objects </a> <nav class=md-nav aria-label="Kubernetes Objects"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#volumes class=md-nav__link> Volumes </a> </li> <li class=md-nav__item> <a href=#configmaps class=md-nav__link> ConfigMaps </a> </li> <li class=md-nav__item> <a href=#secret class=md-nav__link> Secret </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=kubernetes-introduction>Kubernetes Introduction<a class=headerlink href=#kubernetes-introduction title="Permanent link">&para;</a></h1> <p><a href=https://kubernetes.io/ >Kubernetes</a> is an open-source system for automating deployment, scaling, and management of containerized applications. It groups containers that make up an application into logical units for easy management and discovery.</p> <h2 id=key-features>Key features<a class=headerlink href=#key-features title="Permanent link">&para;</a></h2> <p>A Kubernetes cluster consists of one or more physical or virtual machines, also known as worker nodes, that are loosely coupled, extensible, and centrally monitored and managed by the Kubernetes master nodes.</p> <p>A cluster defines a set of resources, nodes, networks, and storage devices that keep applications highly available.</p> <ul> <li><strong>Service discovery</strong> by assigning a single DNS entry to each set of containers, service discovery permits <strong>load-balancing</strong> the request across the pool of containers providing the service, and supports automatic load balancing around failure.</li> <li><strong>Horizontal scaling</strong> is supported by adding new worker nodes to the cluster, or by adding more service instances</li> <li><strong>Self-healing</strong> uses user-defined health checks to monitor containers liveness and restart and reschedule them in case of failure.</li> <li><strong>Automated rollout</strong> gradually roll updates out to your application's containers while checking their status. If something goes wrong during the rollout, Kubernetes can roll back to the previous iteration of the deployment.</li> <li><strong>Secrets and configuration management</strong>: isolate confidential data and configuration as standalone entities</li> <li><strong>Operators</strong> packaged Kubernetes applications that also bring the knowledge of the application's life cycle into the Kubernetes cluster. Applications packaged as Operators use the Kubernetes API to update the cluster's state reacting to changes in the application state.</li> </ul> <h2 id=components>Components<a class=headerlink href=#components title="Permanent link">&para;</a></h2> <p>The following diagram lists the important components of the cluster.</p> <p><img alt src=../images/k8s-components.png></p> <ul> <li><strong>Master nodes</strong> control nodes, and schedule pods. They persist states and configuration in <strong>etcd</strong>.</li> <li><strong>API server</strong> exposes API for the CLI and Web App to validate and support configuration injection</li> <li><strong>kube-control manager</strong> is a daemon that embeds other controllers: node, replications, endpoints, and service account controllers.</li> <li><strong>etcd</strong>: is a distributed key-value pair datastore to persist configuration, to do service discovery and to coordinate distributed work. Backup it.</li> <li><strong>kube-proxy</strong>, is present in each node and perform TCP/UDP packet forwarding across the backend network. It is a network proxy for the services defined in the cluster.</li> <li><strong>kubelet</strong> is the node agent to register a node to the cluster masters. It ensures pods in its node are healthy.</li> </ul> <p>Container images confine the application code, its runtime, and all of its dependencies in a pre-defined format. Container runtime uses those pre-packaged images, to create one or more containers. They run in one host. To have a fault-tolerant and scalable solution we need multiple nodes connected together and controlled by a container orchestrator. It ensures that applications:</p> <ul> <li>are fault-tolerant</li> <li>can do horizontal scaling, and do this on-demand. Scale applications based on resource usage like CPU and memory.</li> <li>support automatic binpacking: schedules the containers based on resource usage and constraints, without sacrifying the availability</li> <li>are self-healed: automatically replaces and reschedules the containers from failed node</li> <li>can discover other applications automatically, and communicate with each other</li> <li>groups sets of containers and refers to them via a DNS name (called a service). It can discover these services automatically, and load-balance requests between containers of a given service</li> <li>are accessible from the external world</li> <li>can update/rollback, without any downtime, new versions/configurations of an application</li> <li>access storage orchestrated via Software Defined Storage</li> <li>support batch execution</li> <li>support VMs, bare-metal, or public/private/hybrid/multi-cloud setups</li> </ul> <h2 id=value-propositions>Value Propositions<a class=headerlink href=#value-propositions title="Permanent link">&para;</a></h2> <p>The key paradigm of Kubernetes is its <code>Declarative model</code>: you provide the "desired state" and Kubernetes will do it's best to make it happens.</p> <ul> <li>high availability 24/7</li> <li>deploy new version multiple times a day</li> <li>containerization of apps and business services</li> <li>helps you make sure those containerized applications run where and when you want, and helps them find the resources and tools they need to work</li> <li>Single-tenant Kubernetes clusters with compute, network and storage infrastructure isolation</li> <li>Automatic scaling of apps</li> <li>Use the cluster dashboard to quickly see and manage the health of your cluster, worker nodes, and container deployments.</li> <li>Automatic re-creation of containers in case of failures</li> <li>Polyglot applications</li> </ul> <h3 id=value-propositions-for-container>Value propositions for container<a class=headerlink href=#value-propositions-for-container title="Permanent link">&para;</a></h3> <p>Just to recall the value of using container for the cloud native application are the following:</p> <ul> <li>Docker ensures consistent environments from development to production. Docker containers are configured to maintain all configurations and dependencies internally.</li> <li>Docker containers allows you to commit changes to your Docker image and version control them. It is very easy to rollback to a previous version of your Docker image. This whole process can be tested in a few minutes.</li> <li>Docker is fast, allowing you to quickly make replications and achieve redundancy.</li> <li>Isolation: Docker makes sure each container has its own resources that are isolated from other containers</li> <li>Removing an app/ container is easy and won’t leave any temporary or configuration files on your host OS.</li> <li>Docker ensures that applications that are running on containers are completely segregated and isolated from each other, granting you complete control over traffic flow and management</li> </ul> <p>The container filesystem is represented as a list of read-only layers stacked on top of each other using a storage driver. The layers are generated when commands are executed during the Docker image build process. The top layer has read-write permissions. </p> <p>Docker daemon configuration is managed by the Docker configuration file (/etc/docker/daemon.json) and Docker daemon startup options are usually controlled by the systemd unit: <code>docker</code>. With environment variables you can control one container, while using <code>linked containers</code> docker automatically copies all environment variables from one container to another.</p> <h2 id=concepts>Concepts<a class=headerlink href=#concepts title="Permanent link">&para;</a></h2> <p>Kubernetes groups containers that make up an application into logical units for easy management and discovery.</p> <p><img alt src=../images/k8s-1.png></p> <p>Every containerized app that is deployed into a Kubernetes cluster is deployed, run, and managed by a <strong>pod</strong>. An app might require a container and other helper containers to be deployed into one pod, so that those containers can be addressed by using the same private IP address</p> <p><em>When a container image runs, it is also executed using namespaces in the operating system. These namespaces contain the process and provide isolation: running container has its own separated file system, own network, own process identifier namespace (PID). While Control Group (CGROUP) allows isolation of hardware resource.</em></p> <ul> <li>The Container Runtime offloads the IP assignment to CNI Container Network Interface: https://github.com/containernetworking/cni. CNI is a specification to define how network interfaces are set for container runtime.</li> <li>In cluster, pod to pod communication should happen across nodes, without any Network Address Translation. So k8s uses Software Define Networking like Calico to support networking https://www.projectcalico.org/</li> </ul> <h2 id=kubernetes-objects>Kubernetes Objects<a class=headerlink href=#kubernetes-objects title="Permanent link">&para;</a></h2> <p>With each object, you declare the intent or desired state using the <em>spec</em> attribute. To create an object, we need to provide the spec field to the Kubernetes API Server. The spec field describes the desired state, along with some basic information, like the name, image name and version.</p> <ul> <li><strong>Pod</strong>: A Pod is a logical collection of one or more containers</li> <li><strong>Labels</strong>: are key-value pairs that can be attached to any Kubernetes objects. Labels are used to organize and select a subset of objects.</li> <li> <p><strong>Label Selectors</strong>, we can select a subset of objects. Two types:</p> <ul> <li>Equality-Based Selectors allow filtering of objects based on label keys and values</li> <li>Set-Based Selectors allow filtering of objects based on a set of values (<code>in, notin, and exist</code> operators)</li> </ul> </li> <li> <p>A <strong>ReplicationController</strong> (rc) is a controller that is part of the Master Node's Controller Manager. It makes sure the specified number of replicas for a Pod is running at any given point in time.</p> </li> <li><strong>A ReplicaSet</strong> (rs) is the next-generation ReplicationController. ReplicaSets support both equality- and set-based Selectors, whereas ReplicationControllers only support equality-based Selectors. A Deployment automatically creates the ReplicaSets.</li> <li><strong>Deployment</strong> objects provide declarative updates to Pods and ReplicaSets. The DeploymentController is part of the Master Node's Controller Manager, and it makes sure that the current state always matches the desired state. Deployments include the definitions for the app to run, it references the docker image to use and which port number exposed to access the app. When you create a deployment, a Kubernetes pod is created for each container that you defined in the deployment. To make your app more resilient, you can define multiple instances of the same app in your deployment and let Kubernetes automatically create a Replica set for you.</li> </ul> <p>When a version of the container image change it is possible to deploy it, and it will create a new replication set. This process is referred to as a Deployment rollout. Once ReplicaSet B is ready, the Deployment starts pointing to it. On top of ReplicaSets, Deployments provide features like Deployment recording, with which, if something goes wrong, we can rollback to a previously known state.</p> <ul> <li><strong>namespace</strong>: If we have numerous users whom we would like to organize into teams/projects, we can partition the Kubernetes cluster into sub-clusters using Namespaces. The names of the resources/objects created inside a Namespace are unique, but not across Namespaces. Generally, Kubernetes creates two default namespaces: kube-system and default. Using Resource Quotas, we can divide the cluster resources within Namespaces. OpenShift maps project to namespace.</li> <li><strong>Services</strong>: allow containers in one pod to open network connections to containers in another pod. In the declaration, the <em>targetPort</em> attribute has to match a containerPort from a pod container definition, and the <em>port</em> attribute is the port that is exposed by the service. <em>selector</em> is how the service finds pods to forward packets to. Each service is dynamically assigned an SRV record with an FQDN of the form: <code>SVC_NAME.PROJECT_NAME.svc.cluster.local</code></li> </ul> <h3 id=volumes>Volumes<a class=headerlink href=#volumes title="Permanent link">&para;</a></h3> <p>All data stored inside a container is deleted if the container crashes. A <strong>Volume</strong> is essentially a directory backed by a storage medium. The storage medium and its content are determined by the Volume Type. A Volume is attached to a Pod and shared among the containers of that Pod. The Volume has the same life span as the Pod, and it outlives the containers of the Pod - this allows data to be preserved across container restarts.</p> <ul> <li>A <strong>PersistentVolume (PV)</strong> is a piece of storage in the cluster that has been provisioned by an administrator. It is a resource in the cluster</li> <li>A <strong>PersistentVolumeClaim (PVC)</strong> is a request for storage by a user/app. It is similar to a pod. Pods consume node resources and PVCs consume PV resources.</li> <li> <p>A <strong>StorageClass</strong> provides a way for administrators to describe the “classes” of storage they offer. Different classes might map to different quality-of-service levels, and to backup policies. Each StorageClass contains the fields provisioner, parameters, and reclaimPolicy. vSphere, minio, GlusterFS, NFS are storage class.</p> </li> <li> <p><strong>Platform Storage</strong>: uses hostPath storage. Consider to make those paths separate, expandable disks so they can be extended as needed.</p> </li> <li><strong>Block Storage</strong>: PV is a block of storage. </li> </ul> <p>There are two ways PVs may be provisioned: statically or dynamically.</p> <ul> <li><strong>Static</strong>: A cluster administrator creates a number of PVs. They carry the details of the real storage which is available for use by cluster users. Cluster administrators must create their disks and export their NFS shares in order for Kubernetes to mount them. Admin defines a PersistentVolume yaml file.</li> <li><strong>Dynamic</strong>: When none of the static PVs the administrator created matches a user’s PersistentVolumeClaim, the cluster may try to dynamically provision a volume specially for the PVC. This provisioning is based on <strong>StorageClasses</strong>: the PVC must request a class and the administrator must have created and configured that class in order for dynamic provisioning to occur.</li> </ul> <p>A control loop in the master watches for new PVCs, finds a matching PV (if possible), and binds them together. Pods use claims as volumes. The cluster inspects the claim to find the bound volume and mounts that volume for a pod.</p> <ul> <li>Master nodes need to run on fast disks because they do use a lot of IO because of ETCD. Use SSDs. </li> <li>Do not run with thin provisioning for VM</li> <li>Separate SAN per cluster. </li> <li>When the cluster runs for a long time, the amount data persisted will become bigger</li> <li>Do not use hostPath storage for user's workload</li> <li>NFS shared storage is used for the docker trusted registry imave repository, but when using a load balancer in front of multiple master nodes, NFS may become a problem due to simultaneous pushes to different nodes of the images. If NFS sync does not happen fast enough you can get 'unknown blob' errors.</li> <li>NFS shared storage can add significant load to the data network at times of high usage. Openshift deprecated NFS for the cluster.</li> <li>With SAN the bottle neck is the sas controller.</li> <li>KVM: kernel based VM is a linux feature to do virutalization. It is faster than VM.</li> <li>NVMe non-volatile memory express. Do not assume IOPS because of the hardware used, verify configuration. </li> <li>The tool to test io is <a href=http://manpages.ubuntu.com/manpages/bionic/man1/fio.1.html>fio</a> </li> </ul> <p><a href=https://kubernetes.io/docs/concepts/storage/persistent-volumes/ >Read more from k8s doc</a></p> <h3 id=configmaps>ConfigMaps<a class=headerlink href=#configmaps title="Permanent link">&para;</a></h3> <p>ConfigMaps allow us to decouple the configuration details from the container image, it passes configuration parameters into the runtime pods without creating different docker images.</p> <ul> <li>Create a ConfigMap with command:</li> </ul> <p><div class=highlight><pre><span></span><code>kubectl create configmap my-config --from-literal=key1=value1 --from-literal=key2=value2
</code></pre></div> or from a yaml file in which we mentioned the kind, metadata, and data fields, which are targeted to connect with the v1 endpoint of the API Server. </p> <p><div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vaccine-order-cm</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>    </span><span class=nt>text_filed</span><span class=p>:</span><span class=w> </span><span class=s>&quot;Hello&quot;</span>
<span class=w>    </span><span class=nt>voro_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;voro.vaccine.svc.cluster.local&quot;</span>
</code></pre></div> * In deployment descriptor all the environment variables will visible via declaration like:</p> <div class=highlight><pre><span></span><code><span class=nt>spec</span><span class=p>:</span>
<span class=w>  </span><span class=nt>template</span><span class=p>:</span>
<span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">demoapp</span>
<span class=w>        </span><span class=nt>envFrom</span><span class=p>:</span>
<span class=w>          </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>configMapRef</span><span class=p>:</span>
<span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vaccine-order-cm</span>
</code></pre></div> <ul> <li>Create a config map from a properties file</li> </ul> <div class=highlight><pre><span></span><code>oc<span class=w> </span>create<span class=w> </span>configmap<span class=w>  </span>demo-app-cm<span class=w> </span>--from-file<span class=o>=</span>./kafka.properties
</code></pre></div> <p>Then in deployment mount it to the target path:</p> <div class=highlight><pre><span></span><code><span class=w>    </span><span class=nt>spec</span><span class=p>:</span>
<span class=w>      </span><span class=nt>containers</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">es-demo</span>
<span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span>
<span class=w>            </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">/deployments</span>
<span class=w>              </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">properties</span>
<span class=w>              </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class=w>              </span><span class=nt>subPath</span><span class=p>:</span><span class=w> </span><span class=s>&quot;&quot;</span>
<span class=w>      </span><span class=nt>volumes</span><span class=p>:</span>
<span class=w>        </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">properties</span>
<span class=w>          </span><span class=nt>secret</span><span class=p>:</span>
<span class=w>            </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">demo-app-cm</span>
</code></pre></div> <h3 id=secret>Secret<a class=headerlink href=#secret title="Permanent link">&para;</a></h3> <p>With Secrets, we can share sensitive information like passwords, tokens, or keys in the form of key-value pairs, encrypted and safe. In Deployments or other system components, the Secret object is referenced, without exposing its content. </p> <div class=highlight><pre><span></span><code>kubectl<span class=w> </span>create<span class=w> </span>secret<span class=w> </span>generic<span class=w> </span>my-password<span class=w> </span>--from-file<span class=o>=</span>password.txt
</code></pre></div> <p>Secret values need to be encrypted with base64. As an example a DB url could be encrypted using: </p> <p><div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span><span class=s2>&quot;jdbc:db2://dashdb--.....services.dal.bluemix.net:50001/BLUDB:sslConnection=true;&quot;</span><span class=w> </span><span class=p>|</span><span class=w> </span>base64
</code></pre></div> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
<span class=nt>metadata</span><span class=p>:</span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">vaccine-order-db-secret</span>
<span class=nt>data</span><span class=p>:</span>
<span class=w>    </span><span class=nt>db.url</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">amRiYzpkY...</span>
</code></pre></div></p> <p>We can get Secrets to be used by containers in a Pod by mounting them as data volumes. </p> <div class=highlight><pre><span></span><code><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KAFKA_CERT_PWD</span>
<span class=w>  </span><span class=nt>valueFrom</span><span class=p>:</span>
<span class=w>    </span><span class=nt>secretKeyRef</span><span class=p>:</span>
<span class=w>      </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">ca.password</span>
<span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kafka-cluster-ca-cert</span>
</code></pre></div> <p><a href=../k8s-1/ >&gt;&gt; NEXT</a></p> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.expand", "navigation.tabs.sticky", "navigation.top"], "search": "../../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>