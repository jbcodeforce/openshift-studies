<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../ocp/oc-cli/ rel=prev><link href=../ocp/notes-ocp-training/ rel=next><link rel=icon href=../assets/images/favicon.png><meta name=generator content="mkdocs-1.4.2, mkdocs-material-9.0.6"><title>Deployment examples - Kubernetes Studies</title><link rel=stylesheet href=../assets/stylesheets/main.558e4712.min.css><link rel=stylesheet href=../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../extra.css><script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#deployments-examples class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=.. title="Kubernetes Studies" class="md-header__button md-logo" aria-label="Kubernetes Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Kubernetes Studies </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Deployment examples </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/jbcodeforce/openshift-studies title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Kubernetes Studies" class="md-nav__button md-logo" aria-label="Kubernetes Studies" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> Kubernetes Studies </label> <div class=md-nav__source> <a href=https://github.com/jbcodeforce/openshift-studies title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Introduction </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 tabindex=0 aria-expanded=false> Kubernetes <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kubernetes data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Kubernetes </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../k8s/k8s-0/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../k8s/k8s-1/ class=md-nav__link> Networking </a> </li> <li class=md-nav__item> <a href=../k8s/k8s-2/ class=md-nav__link> Security </a> </li> <li class=md-nav__item> <a href=../k8s/k8s-3/ class=md-nav__link> Demo it </a> </li> <li class=md-nav__item> <a href=../k8s/k8s-faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../k8s/k8s-comp/ class=md-nav__link> Compendium </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle " data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3 tabindex=0 aria-expanded=true> Openshift <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Openshift data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Openshift </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ocp/ class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../os-cn-dev/ class=md-nav__link> Cloud Native Development </a> </li> <li class=md-nav__item> <a href=../ocp/cp4i/ class=md-nav__link> Cloud Pak Integration </a> </li> <li class=md-nav__item> <a href=../ocp/faq/ class=md-nav__link> FAQ </a> </li> <li class=md-nav__item> <a href=../ocp/oc-cli/ class=md-nav__link> oc CLI </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Deployment examples <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> Deployment examples </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#deploy-zipkin-from-docker-image class=md-nav__link> Deploy zipkin from docker image </a> </li> <li class=md-nav__item> <a href=#deploy-db2 class=md-nav__link> Deploy DB2 </a> </li> <li class=md-nav__item> <a href=#deploy-rabbitmq class=md-nav__link> Deploy RabbitMQ </a> <nav class=md-nav aria-label="Deploy RabbitMQ"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#first-install-operator class=md-nav__link> First install operator </a> </li> <li class=md-nav__item> <a href=#create-a-cluster class=md-nav__link> Create a cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-sparks class=md-nav__link> Deploy sparks </a> </li> <li class=md-nav__item> <a href=#mongodb class=md-nav__link> Mongodb </a> </li> <li class=md-nav__item> <a href=#deploy-jupyter-lab class=md-nav__link> Deploy Jupyter lab </a> </li> <li class=md-nav__item> <a href=#deploy-helm-tiller-deprecated class=md-nav__link> Deploy helm / tiller (DEPRECATED) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ocp/notes-ocp-training/ class=md-nav__link> Notes from certification </a> </li> <li class=md-nav__item> <a href=../spark-on-os/ class=md-nav__link> Operators (with Spark) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle=__nav_4 type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 tabindex=0 aria-expanded=false> Operations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Operations data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Operations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../sre/ class=md-nav__link> SRE </a> </li> <li class=md-nav__item> <a href=../ansible/ class=md-nav__link> Ansible </a> </li> <li class=md-nav__item> <a href=../spark-on-os/ class=md-nav__link> Operators (with Spark) </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../compendium/ class=md-nav__link> Compendium </a> </li> <li class=md-nav__item> <a href=https://jbcodeforce.github.io class=md-nav__link> Return to main </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#deploy-zipkin-from-docker-image class=md-nav__link> Deploy zipkin from docker image </a> </li> <li class=md-nav__item> <a href=#deploy-db2 class=md-nav__link> Deploy DB2 </a> </li> <li class=md-nav__item> <a href=#deploy-rabbitmq class=md-nav__link> Deploy RabbitMQ </a> <nav class=md-nav aria-label="Deploy RabbitMQ"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#first-install-operator class=md-nav__link> First install operator </a> </li> <li class=md-nav__item> <a href=#create-a-cluster class=md-nav__link> Create a cluster </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deploy-sparks class=md-nav__link> Deploy sparks </a> </li> <li class=md-nav__item> <a href=#mongodb class=md-nav__link> Mongodb </a> </li> <li class=md-nav__item> <a href=#deploy-jupyter-lab class=md-nav__link> Deploy Jupyter lab </a> </li> <li class=md-nav__item> <a href=#deploy-helm-tiller-deprecated class=md-nav__link> Deploy helm / tiller (DEPRECATED) </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=deployments-examples>Deployments examples<a class=headerlink href=#deployments-examples title="Permanent link">&para;</a></h1> <p>Multiple ways to deploy an app to openshift:</p> <ol> <li> <p>Deploy an application from an existing Docker image. (Using <code>Deploy Image</code> in the project view.)</p> <p><img alt=1 src=../images/deploy-image.png></p> <div class="admonition note"> <p class=admonition-title>Note</p> <p>There are two options: </p> <ul> <li>from an image imported in the openshift cluster, or built from a dockerfile inside the cluster. </li> <li>by accessing a remote image repository like <code>Dockerhub</code> or <a href=https://quay.io>quay.io</a>. The image will be pulled down and stored within the internal OpenShift image registry. The image will then be copied to any node in the OpenShift cluster where an instance of the application will be scheduled.</li> </ul> <p>Application will, by default, be visible internally to the OpenShift cluster, and usually only to other applications within the same project. Use <code>Create route</code> to make the app public. </p> </div> </li> <li> <p>Build and deploy from source code contained in a Git repository using a <a href=https://github.com/openshift/source-to-image>Source-to-Image</a> toolkit.</p> <p><img alt=2 src=../images/s2i-workflow.png></p> <p>See <a href="https://www.youtube.com/watch?v=flI6zx9wH6M">this video to get s2i presentation</a> and <a href=#s2i>this section</a> goes to a simple Flask app deployment using s2i. </p> </li> <li> <p>Build and deploy from source code contained in a Git repository from a Dockerfile.</p> </li> </ol> <p>Build the first time</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>new-build<span class=w> </span>--binary<span class=w> </span>--name<span class=o>=</span>vertx-greeting-application<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>vertx-greeting-application
mvn<span class=w> </span>dependency:copy-dependencies<span class=w> </span>compile
oc<span class=w> </span>start-build<span class=w> </span>vertx-greeting-application<span class=w> </span>--from-dir<span class=o>=</span>.<span class=w> </span>--follow
oc<span class=w> </span>new-app<span class=w> </span>vertx-greeting-application<span class=w> </span>-l<span class=w> </span><span class=nv>app</span><span class=o>=</span>vertx-greeting-application
oc<span class=w> </span>expose<span class=w> </span>service<span class=w> </span>vertx-greeting-application
</code></pre></div> <p>To update the application, just update the code and run:</p> <div class=highlight><pre><span></span><code>mvn<span class=w> </span>dependency:copy-dependencies<span class=w> </span>compile
oc<span class=w> </span>start-build<span class=w> </span>vertx-greeting-application<span class=w> </span>--from-dir<span class=o>=</span>.<span class=w> </span>--follow
</code></pre></div> <ol> <li> <p>Using Helm charts and helm CLI: Helm can be used as well to define the config files and deploy. Here is a new CI/CD example done from scratch based on the <a href=https://ibm-cloud-architecture.github.io/refarch-reefer-ml>Reefer ML project simulator code</a>.</p> <p><em>See <a href=https://docs.bitnami.com/kubernetes/how-to/create-your-first-helm-chart/ >getting started</a> with helm guide.</em></p> <ul> <li>Create helm chart using the command <code>helm create</code></li> </ul> <div class=highlight><pre><span></span><code><span class=nb>cd</span><span class=w> </span>simulator/chart
helm<span class=w> </span>create<span class=w> </span>kcontainer-reefer-simulator
</code></pre></div> <ul> <li> <p>Change the values.yaml to reflect environment and app settings. Remove Ingress as we will define Openshift route for the app to be visible.</p> </li> <li> <p>In the templates folder modify the deployment.yaml to add env variables section:</p> </li> </ul> <div class=highlight><pre><span></span><code><span class=nt>env</span><span class=p>:</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">PORT</span>
<span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Values.service.servicePort</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">APPLICATION_NAME</span>
<span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Release.Name</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KAFKA_BROKERS</span>
<span class=w>        </span><span class=nt>valueFrom</span><span class=p>:</span>
<span class=w>          </span><span class=nt>configMapKeyRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Values.kafka.brokersConfigMap</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=w>            </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">brokers</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">TELEMETRY_TOPIC</span>
<span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Values.kafka.telemetryTopicName</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">CONTAINER_TOPIC</span>
<span class=w>        </span><span class=nt>value</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Values.kafka.containerTopicName</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=w>      </span><span class="p p-Indicator">{{</span><span class=nv>- if .Values.eventstreams.enabled</span><span class=w> </span><span class="p p-Indicator">}}</span>
<span class=w>      </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">KAFKA_APIKEY</span>
<span class=w>        </span><span class=nt>valueFrom</span><span class=p>:</span>
<span class=w>          </span><span class=nt>secretKeyRef</span><span class=p>:</span>
<span class=w>            </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s>&quot;{{</span><span class=nv> </span><span class=s>.Values.eventstreams.apikeyConfigMap</span><span class=nv> </span><span class=s>}}&quot;</span>
<span class=w>            </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">binding</span>
<span class=w>      </span><span class="p p-Indicator">{{</span><span class=nv>- end</span><span class=w> </span><span class="p p-Indicator">}}</span>
</code></pre></div> <ul> <li>Create helm template file for deployment:</li> </ul> <div class=highlight><pre><span></span><code>helm<span class=w> </span>template<span class=w> </span>--output-dir<span class=w> </span>templates<span class=w> </span>--namespace<span class=w> </span>eda-demo<span class=w> </span>chart/kcontainer-reefer-simulator/
</code></pre></div> <ul> <li>Push the service.yaml and deployment.yml template to the gitops <a href=https://github.com/ibm-cloud-architecture/refarch-kc-gitops>repository</a> under the branch <code>eda-demo/gse-eda-demos.us-east.containers.appdomain.cloud</code>.</li> <li>In the github repository define secrets environment variables for docker username and password, from your docker hub account.</li> <li>When pushing the repository the gitAction will perform the build.</li> </ul> </li> </ol> <h2 id=deploy-zipkin-from-docker-image>Deploy zipkin from docker image<a class=headerlink href=#deploy-zipkin-from-docker-image title="Permanent link">&para;</a></h2> <p>Install it, and expose it with a service</p> <p><div class=highlight><pre><span></span><code>oc new-app --docker-image=openzipkin/zipkin

oc expose svc/zipkin
</code></pre></div> A new route is created visible with <code>oc get routes</code>. Once the hostname is added to a DNS or /etc/hosts. </p> <p>See zipkin architecture <a href=https://zipkin.io/pages/architecture.html>article here</a></p> <h2 id=deploy-db2>Deploy DB2<a class=headerlink href=#deploy-db2 title="Permanent link">&para;</a></h2> <p>The Community edition DB2 image on <a href=https://hub.docker.com/r/ibmcom/db2>dockerhub</a>. It includes a predefined DB.</p> <p>Clone the <a href=https://github.com/IBM/Db2>DB2 repository</a> to get the helm chart. See <a href=https://github.com/IBM/Db2/tree/develop/deployment>readme</a> in this repo, for installation using helm but <a href=#deploy-helm-tiller>tiller</a> needs to be installed before. The repository includes a script: <code>db2u-install</code></p> <p>Create your own docker image with a shell to create the schema:</p> <div class=highlight><pre><span></span><code><span class=k>FROM</span><span class=w> </span><span class=s>ibmcom/db2</span>

<span class=k>RUN</span><span class=w> </span>mkdir<span class=w> </span>/var/custom
<span class=k>COPY</span><span class=w> </span>createschema.sh<span class=w> </span>/var/custom
<span class=k>RUN</span><span class=w> </span>chmod<span class=w> </span>a+x<span class=w> </span>/var/custom/createschema.sh
</code></pre></div> <p>Deinstalling configuration</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>delete<span class=w> </span>-n<span class=w> </span>jbsandbox<span class=w> </span>sa/db2u<span class=w> </span>role/db2u-role<span class=w> </span>rolebinding/db2u-rolebinding
</code></pre></div> <h2 id=deploy-rabbitmq>Deploy RabbitMQ<a class=headerlink href=#deploy-rabbitmq title="Permanent link">&para;</a></h2> <h3 id=first-install-operator>First install operator<a class=headerlink href=#first-install-operator title="Permanent link">&para;</a></h3> <p>To create a RabbitMQ instance, a RabbitmqCluster resource definition must be created and applied. RabbitMQ Cluster Kubernetes Operator creates the necessary resources, such as Services and StatefulSet, in the same namespace in which the <code>RabbitmqCluster</code> CRD was defined.</p> <p>See <a href=https://www.rabbitmq.com/kubernetes/operator/install-operator.html>some instructions here</a>. Be sure to have kubectl &gt;= 1.14</p> <div class=highlight><pre><span></span><code>git<span class=w> </span>clone<span class=w> </span>http://github.com/rabbitmq/cluster-operator.git
<span class=nb>cd</span><span class=w> </span>cluster-operator
kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>config/namespace/base/namespace.yaml
kubectl<span class=w> </span>create<span class=w> </span>-f<span class=w> </span>config/crd/bases/rabbitmq.com_rabbitmqclusters.yaml
<span class=c1># Add cluster roles and roles: rabbitmq-cluster-operator-role and rabbitmq-cluster-leader-election-role</span>
kubectl<span class=w> </span>-n<span class=w> </span>rabbitmq-system<span class=w> </span>create<span class=w> </span>--kustomize<span class=w> </span>config/rbac/
kubectl<span class=w> </span>-n<span class=w> </span>rabbitmq-system<span class=w> </span>create<span class=w> </span>--kustomize<span class=w> </span>config/manager/
<span class=c1># Verify CRD installed</span>
kubectl<span class=w> </span>get<span class=w> </span>customresourcedefinitions.apiextensions.k8s.io<span class=w> </span><span class=p>|</span><span class=w> </span>grep<span class=w> </span>rabbit
<span class=c1># Verify the service account</span>
oc<span class=w> </span>get<span class=w> </span>sa<span class=w> </span>rabbitmq-cluster-operator
<span class=c1># link the service account to security policy</span>
oc<span class=w> </span>adm<span class=w> </span>policy<span class=w> </span>add-scc-to-user<span class=w> </span>privileged<span class=w> </span>rabbitmq-cluster-operator
</code></pre></div> <p>If there is an error about user 1000 not in range, change the deployment yaml file for the value <code>securityContext.runAsUser: 1000570000</code> to a value in range and remove the other runAsGroup and fsGroup.</p> <h3 id=create-a-cluster>Create a cluster<a class=headerlink href=#create-a-cluster title="Permanent link">&para;</a></h3> <p>when the operator pod runs, create one instance create a yaml file:</p> <div class=highlight><pre><span></span><code>apiVersion:<span class=w> </span>rabbitmq.com/v1beta1
kind:<span class=w> </span>RabbitmqCluster
metadata:
<span class=w>  </span>name:<span class=w> </span>eda-rabbitmq
spec:
<span class=w>    </span>replicas:<span class=w> </span><span class=m>1</span>
</code></pre></div> <p>Then do</p> <div class=highlight><pre><span></span><code>oc apply -f rabbit-cluster.yaml 
oc get rabbitmqclusters
</code></pre></div> <p>If an error like: "services \"eda-rabbitmq-rabbitmq-headless\" is forbidden: cannot set blockOwnerDeletion if an ownerReference refers to a resource you can't set finalizers on" happens, do the following: </p> <div class=highlight><pre><span></span><code>
</code></pre></div> <h2 id=deploy-sparks>Deploy sparks<a class=headerlink href=#deploy-sparks title="Permanent link">&para;</a></h2> <p><a href=../spark-on-os/ >Using the operator, see this note</a></p> <h2 id=mongodb>Mongodb<a class=headerlink href=#mongodb title="Permanent link">&para;</a></h2> <p>Define an env file with the following variables: MONGODB_USER=mongo MONGODB_PASSWORD=mongo MONGODB_DATABASE=reeferdb MONGODB_ADMIN_PASSWORD=password</p> <p>then run:</p> <div class=highlight><pre><span></span><code>oc new-app --env-file=mongo.env --docker-image=openshift/mongodb-24-centos7
</code></pre></div> <p>See the service:</p> <div class=highlight><pre><span></span><code>oc describe svc mongodb-24-centos7
</code></pre></div> <p>For more detail see <a href=https://docs.openshift.com/enterprise/3.0/using_images/db_images/mongodb.html>this note</a></p> <h2 id=deploy-jupyter-lab>Deploy Jupyter lab<a class=headerlink href=#deploy-jupyter-lab title="Permanent link">&para;</a></h2> <p>See <a href=https://blog.openshift.com/jupyter-openshift-part-2-using-jupyter-project-images/ >this note</a> to deploy Jupyter lab lastest image to Openshift using the Deploy Image choice. The deployment is done under the project <code>reefer-shipment-solution</code></p> <p><img alt src=../images/jupyterlab-1.png></p> <p>The environment variable needs to be set to get Jupyter lab. </p> <p><img alt src=../images/jupyterlab-2.png></p> <p>It takes multiple minutes to deploy. For the permission error due to the jovyan user not known, the command was:</p> <div class=highlight><pre><span></span><code>oc adm policy add-scc-to-user anyuid -z default -n reefer-shipment-solution
</code></pre></div> <div class=highlight><pre><span></span><code> oc get routes
NAME  HOST/PORT   PATH      SERVICES                PORT       TERMINATION   WILDCARD
jupyterlab              jupyterlab-reefer-shipment-solution.greencluster-fa9ee67c9ab6a7791435450358e564cc-0001.us-east.containers.appdomain.cloud    all-spark-notebook   8888-tcp      None
</code></pre></div> <p>Get the secuity token to login in via the pod logs.</p> <div class=highlight><pre><span></span><code>oc get pods 
NAME                             READY     STATUS      RESTARTS   AGE
all-spark-notebook-2-z4dqx  
</code></pre></div> <div class=highlight><pre><span></span><code>oc logs all-spark-notebook-2-z4dqx 
</code></pre></div> <p>To avoid loosing the work on the notebook, we need to add PVC to <code>/home/jovyan/work</code> mount point</p> <div class=highlight><pre><span></span><code>oc get dc

oc set volume dc/all-spark-notebook  --add --mount-path /home/jovyan/work --claim-size=1G
</code></pre></div> <h2 id=deploy-helm-tiller-deprecated>Deploy helm / tiller (DEPRECATED)<a class=headerlink href=#deploy-helm-tiller-deprecated title="Permanent link">&para;</a></h2> <p>The goal is to install Tiller server on its own project, and grant it permissions to one or more other projects where Helm Charts will be installed.</p> <p>See the instructions in <a href=https://www.openshift.com/blog/getting-started-helm-openshift>this blog</a>.</p> <p>Here is a quick summary of the commands performed</p> <div class=highlight><pre><span></span><code>oc new-project tiller
oc project tiller
export TILLER_NAMESPACE=tiller
oc process -f https://github.com/openshift/origin/raw/master/examples/helm/tiller-template.yaml -p TILLER_NAMESPACE=&quot;${TILLER_NAMESPACE}&quot; -p HELM_VERSION=v2.16.4 | oc create -f -
</code></pre></div> <p>Once deployed and Tiller server running, create a new project and grant tiller edit role to access this new project, and then use helm CLI to deploy the app:</p> <div class=highlight><pre><span></span><code>oc<span class=w> </span>new-project<span class=w> </span>myapp
oc<span class=w> </span>policy<span class=w> </span>add-role-to-user<span class=w> </span>edit<span class=w> </span><span class=s2>&quot;system:serviceaccount:</span><span class=si>${</span><span class=nv>TILLER_NAMESPACE</span><span class=si>}</span><span class=s2>:tiller&quot;</span>
</code></pre></div> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "..", "features": ["content.code.annotate", "content.tooltips", "navigation.instant", "navigation.expand", "navigation.tabs.sticky", "navigation.top"], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=../assets/javascripts/bundle.51d95adb.min.js></script> </body> </html>